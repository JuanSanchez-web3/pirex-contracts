# IFunctionsBillingRegistry

## Functions
### getRequestConfig

Get configuration relevant for making requests


```solidity
function getRequestConfig() external view returns (uint32, address[] memory);
```
**Returns**

|Name|Type|Description|
|----|----|-----------|
|`<none>`|`uint32`|uint32 global max for request gas limit|
|`<none>`|`address[]`|address[] list of registered DONs|


### getRequiredFee

Determine the charged fee that will be paid to the Registry owner


```solidity
function getRequiredFee(bytes calldata data, RequestBilling memory billing) external view returns (uint96);
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`data`|`bytes`|Encoded Chainlink Functions request data, use FunctionsClient API to encode a request|
|`billing`|`RequestBilling`|The request's billing configuration|

**Returns**

|Name|Type|Description|
|----|----|-----------|
|`<none>`|`uint96`|fee Cost in Juels (1e18) of LINK|


### estimateCost

Estimate the total cost to make a request: gas re-imbursement, plus DON fee, plus Registry fee


```solidity
function estimateCost(uint32 gasLimit, uint256 gasPrice, uint96 donFee, uint96 registryFee)
    external
    view
    returns (uint96);
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`gasLimit`|`uint32`|Encoded Chainlink Functions request data, use FunctionsClient API to encode a request|
|`gasPrice`|`uint256`|The request's billing configuration|
|`donFee`|`uint96`|Fee charged by the DON that is paid to Oracle Node|
|`registryFee`|`uint96`|Fee charged by the DON that is paid to Oracle Node|

**Returns**

|Name|Type|Description|
|----|----|-----------|
|`<none>`|`uint96`|costEstimate Cost in Juels (1e18) of LINK|


### startBilling

Initiate the billing process for an Functions request

*Only callable by a node that has been approved on the Registry*


```solidity
function startBilling(bytes calldata data, RequestBilling calldata billing) external returns (bytes32);
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`data`|`bytes`|Encoded Chainlink Functions request data, use FunctionsClient API to encode a request|
|`billing`|`RequestBilling`|Billing configuration for the request|

**Returns**

|Name|Type|Description|
|----|----|-----------|
|`<none>`|`bytes32`|requestId - A unique identifier of the request. Can be used to match a request to a response in fulfillRequest.|


### fulfillAndBill

Finalize billing process for an Functions request by sending a callback to the Client contract and then charging the subscription

*Only callable by a node that has been approved on the Registry*

*simulated offchain to determine if sufficient balance is present to fulfill the request*


```solidity
function fulfillAndBill(
    bytes32 requestId,
    bytes calldata response,
    bytes calldata err,
    address transmitter,
    address[31] memory signers,
    uint8 signerCount,
    uint256 reportValidationGas,
    uint256 initialGas
) external returns (FulfillResult);
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`requestId`|`bytes32`|identifier for the request that was generated by the Registry in the beginBilling commitment|
|`response`|`bytes`|response data from DON consensus|
|`err`|`bytes`|error from DON consensus|
|`transmitter`|`address`|the Oracle who sent the report|
|`signers`|`address[31]`|the Oracles who had a part in generating the report|
|`signerCount`|`uint8`|the number of signers on the report|
|`reportValidationGas`|`uint256`|the amount of gas used for the report validation. Cost is split by all fulfillments on the report.|
|`initialGas`|`uint256`|the initial amount of gas that should be used as a baseline to charge the single fulfillment for execution cost|

**Returns**

|Name|Type|Description|
|----|----|-----------|
|`<none>`|`FulfillResult`|result fulfillment result|


### getSubscriptionOwner

Gets subscription owner.


```solidity
function getSubscriptionOwner(uint64 subscriptionId) external view returns (address owner);
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`subscriptionId`|`uint64`|- ID of the subscription|

**Returns**

|Name|Type|Description|
|----|----|-----------|
|`owner`|`address`|- owner of the subscription.|


## Structs
### RequestBilling

```solidity
struct RequestBilling {
    uint64 subscriptionId;
    address client;
    uint32 gasLimit;
    uint256 gasPrice;
}
```

## Enums
### FulfillResult

```solidity
enum FulfillResult {
    USER_SUCCESS,
    USER_ERROR,
    INVALID_REQUEST_ID
}
```

